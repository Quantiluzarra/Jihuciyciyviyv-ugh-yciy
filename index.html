<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>AI Arena Online</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #333;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      margin-top: 10px;
    }
    #gameContainer {
      display: inline-block;
      position: relative;
      margin-top: 10px;
    }
    #gameCanvas {
      background: #222;
      display: block;
      margin: 0 auto;
      border: 2px solid #555;
    }
    #uiPanel {
      margin-top: 10px;
    }
    #balance {
      font-weight: bold;
      color: #ffd700;
    }
    #redOdds, #blueOdds {
      font-weight: bold;
    }
    .betButton {
      padding: 6px 12px;
      margin: 4px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .redButton {
      background-color: #e74c3c;
      color: #fff;
    }
    .blueButton {
      background-color: #3498db;
      color: #fff;
    }
    .startButton {
      background-color: #2ecc71;
      color: #fff;
      padding: 8px 16px;
      margin-top: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>

<h1>AI Arena Online</h1>

<div id="uiPanel">
  <div>–í–∞—à –±–∞–ª–∞–Ω—Å: <span id="balance">1000</span> C</div>
  <div>
    –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å—Ç–∞–≤–æ–∫: 
    <span>–ö—Ä–∞—Å–Ω—ã–π: <span id="redOdds"></span></span>, 
    <span>–°–∏–Ω–∏–π: <span id="blueOdds"></span></span>
  </div>
  <div style="margin-top: 6px;">
    –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏: 
    <input id="betAmount" type="number" value="100" min="1" style="width:80px;text-align:center;" />
  </div>
  <div style="margin-top: 6px;">
    <button class="betButton redButton" onclick="betOn('red')">–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ö—Ä–∞—Å–Ω–æ–≥–æ</button>
    <button class="betButton blueButton" onclick="betOn('blue')">–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –°–∏–Ω–µ–≥–æ</button>
  </div>
  <div style="margin-top: 6px;">
    <button class="startButton" id="startGameBtn" onclick="startGame()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –∏ –Ω–∞—á–∞—Ç—å –±–æ–π</button>
  </div>
</div>

<div id="gameContainer">
  <canvas id="gameCanvas" width="640" height="640"></canvas>
</div>

<script>
// ----------------------- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï -----------------------

// –†–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏
const GRID_WIDTH  = 20;
const GRID_HEIGHT = 20;
const CELL_SIZE   = 32;  // –ü–∏–∫—Å–µ–ª–∏ –Ω–∞ –æ–¥–Ω—É —è—á–µ–π–∫—É

// –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã (–ò–ò)
let redAI = null;
let blueAI = null;

// –ú–∞—Å—Å–∏–≤, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ —Ü–≤–µ—Ç —è—á–µ–µ–∫: 0 - –Ω–∏—á—å—è, 1 - –∫—Ä–∞—Å–Ω—ã–π, 2 - —Å–∏–Ω–∏–π
let grid = [];

// –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
let gameInterval = null;
let gameRunning = false;

// –ë–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ –∏ —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫
let playerBalance = 1000;
let betTeam = null;     // 'red' –∏–ª–∏ 'blue'
let betValue = 0;       // –°—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –∏–≥—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∏–ª
let redOddsValue  = 1.5; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –ö—Ä–∞—Å–Ω–æ–≥–æ
let blueOddsValue = 1.5; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –°–∏–Ω–µ–≥–æ

// –°—Å—ã–ª–∫–∞ –Ω–∞ canvas/–∫–æ–Ω—Ç–µ–∫—Å—Ç
const canvas  = document.getElementById('gameCanvas');
const ctx     = canvas.getContext('2d');

// –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–π: –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –¥–æ –Ω–µ–±–æ–ª—å—à–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
let emojiList = [];

// ----------------------- –§–£–ù–ö–¶–ò–ò –°–¢–ê–í–û–ö -----------------------
function betOn(team) {
  if (gameRunning) return; // –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —Å—Ç–∞–≤–∫—É –≤–æ –≤—Ä–µ–º—è –±–æ—è
  
  const inputEl = document.getElementById('betAmount');
  const amount  = parseInt(inputEl.value);
  
  if (amount <= 0 || isNaN(amount)) {
    alert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
    return;
  }
  if (amount > playerBalance) {
    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Ç–∞–∫–æ–π —Å—Ç–∞–≤–∫–∏!');
    return;
  }
  
  betTeam = team;
  betValue = amount;
  
  // –î–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –ø–æ–¥—Å–≤–µ—Ç–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç–∞–≤–∫—É
  alert(`–°—Ç–∞–≤–∫–∞ ${betValue} C –Ω–∞ ${team === 'red' ? '–ö—Ä–∞—Å–Ω–æ–≥–æ' : '–°–∏–Ω–µ–≥–æ'}.`);
}

// ----------------------- –°–¢–ê–†–¢/–†–ï–°–¢–ê–†–¢ –ò–ì–†–´ -----------------------
function startGame() {
  if (gameRunning) return; // –ï—Å–ª–∏ –∏–≥—Ä–∞ —É–∂–µ –∏–¥—ë—Ç
  
  if (!betTeam) {
    alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞ –∫–æ–≥–æ —Å—Ç–∞–≤–∏—Ç–µ!');
    return;
  }
  if (betValue <= 0) {
    alert('–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0!');
    return;
  }
  if (betValue > playerBalance) {
    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
    return;
  }
  
  // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
  playerBalance -= betValue;
  updateUI();
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º (–∏–ª–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º) –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∑–∞–Ω–æ–≤–æ, 
  // —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –±–æ–π –∏–º–µ–ª –Ω–µ–∫–æ—Ç–æ—Ä—É—é –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
  redOddsValue  = (1.2 + Math.random() * 1.0).toFixed(2);  // –æ—Ç ~1.2 –¥–æ ~2.2
  blueOddsValue = (1.2 + Math.random() * 1.0).toFixed(2);
  document.getElementById('redOdds').innerText  = redOddsValue;
  document.getElementById('blueOdds').innerText = blueOddsValue;
  
  initGame();
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª –∏–≥—Ä—ã
  gameRunning = true;
  gameInterval = setInterval(gameLoop, 400); // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ~2-3 —Ä–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã
function initGame() {
  // –û–±–Ω—É–ª—è–µ–º —Å–µ—Ç–∫—É
  grid = [];
  for (let y = 0; y < GRID_HEIGHT; y++) {
    let row = [];
    for (let x = 0; x < GRID_WIDTH; x++) {
      row.push(0);
    }
    grid.push(row);
  }
  
  // –°–æ–∑–¥–∞—ë–º –ö—Ä–∞—Å–Ω–æ–≥–æ –ò–ò
  redAI = {
    x: 0,
    y: 0,
    hp: 100,
    color: 'red',
    baseX: 0,
    baseY: 0,
    memory: {},     // –î–ª—è —É–ø—Ä–æ—â—ë–Ω–Ω–æ–π "–ø–∞–º—è—Ç–∏" —Ö–æ–¥–æ–≤
    lastAction: null,
    type: 1
  };
  // –°–æ–∑–¥–∞—ë–º –°–∏–Ω–µ–≥–æ (–≥–æ–ª—É–±–æ–≥–æ) –ò–ò
  blueAI = {
    x: GRID_WIDTH - 1,
    y: GRID_HEIGHT - 1,
    hp: 100,
    color: 'blue',
    baseX: GRID_WIDTH - 1,
    baseY: GRID_HEIGHT - 1,
    memory: {},
    lastAction: null,
    type: 2
  };
  
  // –û–±–æ–∑–Ω–∞—á–∞–µ–º –±–∞–∑—ã
  grid[redAI.y][redAI.x]   = 1; // –∫—Ä–∞—Å–Ω–∞—è –±–∞–∑–∞
  grid[blueAI.y][blueAI.x] = 2; // —Å–∏–Ω—è—è –±–∞–∑–∞
  
  // –°–±—Ä–æ—Å —ç–º–æ—Ü–∏–π
  emojiList = [];
  
  // –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
  render();
}

// ----------------------- –û–ë–ù–û–í–õ–ï–ù–ò–ï UI -----------------------
function updateUI() {
  document.getElementById('balance').innerText = playerBalance;
  document.getElementById('redOdds').innerText  = redOddsValue;
  document.getElementById('blueOdds').innerText = blueOddsValue;
}

// ----------------------- –ò–ì–†–û–í–û–ô –¶–ò–ö–õ -----------------------
function gameLoop() {
  // 1. –•–æ–¥ –ö—Ä–∞—Å–Ω–æ–≥–æ
  makeAIMove(redAI, blueAI);
  // 2. –•–æ–¥ –°–∏–Ω–µ–≥–æ
  makeAIMove(blueAI, redAI);
  
  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (—É–±–∏—Ç–∞ –±–∞–∑–∞ –∏–ª–∏ HP)
  checkWinCondition();
  
  // 4. –†–∏—Å—É–µ–º
  render();
}

// ----------------------- "–ò–ù–¢–ï–õ–õ–ï–ö–¢" –ò–ò -----------------------
function makeAIMove(ai, opponent) {
  if (ai.hp <= 0) return; // —É–∂–µ –ø—Ä–æ–∏–≥—Ä–∞–ª
  
  // –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ "–æ–±—É—á–µ–Ω–∏—é":
  // ai.memory = { stateKey: { up: score, down: score, left: score, right: score } }
  // stateKey –º–æ–∂–Ω–æ —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å, –Ω–∞–ø—Ä. —É—á–∏—Ç—ã–≤–∞—Ç—å –ª–∏—à—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞.
  
  const dx = opponent.x - ai.x;
  const dy = opponent.y - ai.y;
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª—é—á —Å–æ—Å—Ç–æ—è–Ω–∏—è:
  // –ù–∞–ø—Ä–∏–º–µ—Ä, "dx,dy"
  const stateKey = dx + ',' + dy;
  
  if (!ai.memory[stateKey]) {
    ai.memory[stateKey] = {
      up: 0,
      down: 0,
      left: 0,
      right: 0
    };
  }
  
  // –°–æ—Å—Ç–∞–≤–∏–º —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
  const possibleMoves = [];
  
  // –ú—ã –º–æ–∂–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è: –≤–≤–µ—Ä—Ö, –≤–Ω–∏–∑, –≤–ª–µ–≤–æ, –≤–ø—Ä–∞–≤–æ (–µ—Å–ª–∏ –Ω–µ –≤—ã–π–¥–µ–º –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã)
  // –î–æ–±–∞–≤–∏–º –∫–∞–∂–¥–æ–º—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é "–≤–µ—Å", –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –ø–∞–º—è—Ç–∏ –∏ –Ω–µ–±–æ–ª—å—à–æ–º —Ä–∞–Ω–¥–æ–º–µ
  const mem = ai.memory[stateKey];
  
  function pushMove(name, px, py) {
    if (ai.x + px >= 0 && ai.x + px < GRID_WIDTH &&
        ai.y + py >= 0 && ai.y + py < GRID_HEIGHT) {
      // –í–µ—Å = –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏ + –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–Ω–¥–æ–º
      const weight = mem[name] + Math.random() * 1.0;
      possibleMoves.push({ name, px, py, weight });
    }
  }
  
  pushMove('up',    0, -1);
  pushMove('down',  0,  1);
  pushMove('left', -1,  0);
  pushMove('right',1,  0);
  
  // –í—ã–±–∏—Ä–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º "–≤–µ—Å–æ–º"
  possibleMoves.sort((a, b) => b.weight - a.weight);
  const bestMove = possibleMoves[0];
  
  // –°–æ—Ö—Ä–∞–Ω–∏–º –¥–µ–π—Å—Ç–≤–∏–µ, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø–æ–Ω—è—Ç—å, –±—ã–ª–æ –ª–∏ –æ–Ω–æ —É—Å–ø–µ—à–Ω—ã–º
  ai.lastAction = {
    stateKey: stateKey,
    direction: bestMove.name
  };
  
  // –î–≤–∏–≥–∞–µ–º—Å—è
  const oldX = ai.x;
  const oldY = ai.y;
  
  ai.x += bestMove.px;
  ai.y += bestMove.py;
  
  // –ï—Å–ª–∏ –≤–æ—à–ª–∏ –Ω–∞ –∫–ª–µ—Ç–∫—É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –±–∏—Ç–≤—É
  if (ai.x === opponent.x && ai.y === opponent.y && opponent.hp > 0) {
    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ—Ç–µ—Ä—è HP —É –æ–±–æ–∏—Ö
    const dmgAI       = Math.floor(Math.random() * 20); 
    const dmgOpponent = Math.floor(Math.random() * 20);
    ai.hp       = Math.max(0, ai.hp - dmgAI);
    opponent.hp = Math.max(0, opponent.hp - dmgOpponent);
    
    // –ü–æ–∫–∞–∂–µ–º —ç–º–æ—Ü–∏–∏
    showEmoji(ai, 'üí•');
    showEmoji(opponent, 'üí•');
    
    // –û—Ü–µ–Ω–∏–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ–¥ –æ–∫–∞–∑–∞–ª—Å—è "–≤—ã–≥–æ–¥–Ω—ã–º" (–º–∏–∫—Ä–æ-–æ–±—É—á–µ–Ω–∏–µ)
    // –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º—ã —Å–∞–º–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ –º–µ–Ω—å—à–µ HP, —á–µ–º –≤—Ä–∞–≥ ‚Äî —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ —É—Å–ø–µ—Ö–æ–º
    const reward = (dmgOpponent - dmgAI);
    mem[bestMove.name] += reward * 0.1; 
  }
  
  // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–ª–µ—Ç–∫—É
  const oldControl = grid[ai.y][ai.x];
  if (oldControl !== ai.type) {
    // –ï—Å–ª–∏ –ø–µ—Ä–µ–∑–∞—Ö–≤–∞—Ç–∏–ª–∏ –∫–ª–µ—Ç–∫—É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ ‚Äî —ç—Ç–æ —É—Å–ø–µ—Ö
    if (oldControl !== 0 && oldControl !== ai.type) {
      showEmoji(ai, 'üòé'); 
      // –°—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π —Ö–æ–¥
      mem[bestMove.name] += 0.5;
      
      // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ "–∑–ª–∏—Ç—Å—è"
      if (opponent.hp > 0) {
        showEmoji(opponent, 'üò°');
      }
    }
    
    grid[ai.y][ai.x] = ai.type;
  }
}

// ----------------------- –ü–†–û–í–ï–†–ö–ê –ü–û–ë–ï–î–´ -----------------------
function checkWinCondition() {
  // –ï—Å–ª–∏ –±–∞–∑–∞ –ö—Ä–∞—Å–Ω–æ–≥–æ –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –°–∏–Ω–∏–º
  if (grid[redAI.baseY][redAI.baseX] === 2 || redAI.hp <= 0) {
    endGame('blue');
  }
  // –ï—Å–ª–∏ –±–∞–∑–∞ –°–∏–Ω–µ–≥–æ –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –ö—Ä–∞—Å–Ω—ã–º
  else if (grid[blueAI.baseY][blueAI.baseX] === 1 || blueAI.hp <= 0) {
    endGame('red');
  }
}

// ----------------------- –ó–ê–í–ï–†–®–ï–ù–ò–ï –ò–ì–†–´ -----------------------
function endGame(winner) {
  if (!gameRunning) return;
  
  clearInterval(gameInterval);
  gameRunning = false;
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤—ã–∏–≥—Ä–∞–ª –ª–∏ –∏–≥—Ä–æ–∫
  if (winner === betTeam) {
    // –í—ã–ø–ª–∞—Ç–∞
    let odds = (winner === 'red') ? parseFloat(redOddsValue) : parseFloat(blueOddsValue);
    const winAmount = Math.floor(betValue * odds);
    playerBalance += winAmount;
    alert(`–ü–æ–±–µ–¥–∏–ª ${winner === 'red' ? '–ö—Ä–∞—Å–Ω—ã–π' : '–°–∏–Ω–∏–π'}! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} C!`);
  } else {
    alert(`–ü–æ–±–µ–¥–∏–ª ${winner === 'red' ? '–ö—Ä–∞—Å–Ω—ã–π' : '–°–∏–Ω–∏–π'}! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ —Å—Ç–∞–≤–∫—É.`);
  }
  
  // –°–±—Ä–æ—Å —Å—Ç–∞–≤–∫–∏
  betTeam = null;
  betValue = 0;
  updateUI();
}

// ----------------------- –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –≠–ú–û–¶–ò–ô -----------------------
function showEmoji(ai, symbol) {
  emojiList.push({
    x: ai.x,
    y: ai.y,
    symbol: symbol,
    time: Date.now(),
    aiType: ai.type
  });
}

// ----------------------- –†–ï–ù–î–ï–† -----------------------
function render() {
  // –û—á–∏—â–∞–µ–º
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // –†–∏—Å—É–µ–º –∫–ª–µ—Ç–∫–∏
  for (let y = 0; y < GRID_HEIGHT; y++) {
    for (let x = 0; x < GRID_WIDTH; x++) {
      let color = '#444';
      if (grid[y][x] === 1) {
        color = 'red';
      } else if (grid[y][x] === 2) {
        color = 'blue';
      }
      
      ctx.fillStyle = color;
      ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    }
  }
  
  // –†–∏—Å—É–µ–º –ò–ò –∫–∞–∫ –∫–≤–∞–¥—Ä–∞—Ç—ã —Å –æ–±–≤–æ–¥–∫–æ–π
  drawAI(redAI);
  drawAI(blueAI);
  
  // –†–∏—Å—É–µ–º –ø–æ–ª–æ—Å–∫–∏ HP
  drawHPBar(redAI);
  drawHPBar(blueAI);
  
  // –†–∏—Å—É–µ–º —ç–º–æ—Ü–∏–∏
  drawEmojis();
}

function drawAI(ai) {
  if (ai.hp <= 0) return; // –ú—ë—Ä—Ç–≤—ã–π –Ω–µ —Ä–∏—Å—É–µ–º, –∏–ª–∏ –º–æ–∂–Ω–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ç—ë–º–Ω—ã–π
  
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 2;
  
  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ –ª–µ–≤–æ–≥–æ —É–≥–ª–∞
  const px = ai.x * CELL_SIZE;
  const py = ai.y * CELL_SIZE;
  
  ctx.strokeRect(px + 2, py + 2, CELL_SIZE - 4, CELL_SIZE - 4);
}

function drawHPBar(ai) {
  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–¥ –∫–ª–µ—Ç–∫–æ–π
  const barWidth  = CELL_SIZE - 4;
  const barHeight = 5;
  
  const px = ai.x * CELL_SIZE + 2;
  const py = ai.y * CELL_SIZE - 8; // —á—É—Ç—å –≤—ã—à–µ
  
  // –†–∞–º–∫–∞
  ctx.fillStyle = '#000';
  ctx.fillRect(px, py, barWidth, barHeight);
  
  // –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å
  const hpPercent = ai.hp / 100;
  let color = (ai.color === 'red') ? '#ff5555' : '#55aaff';
  ctx.fillStyle = color;
  ctx.fillRect(px, py, barWidth * hpPercent, barHeight);
}

function drawEmojis() {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ—Ü–∏–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ ~1.5 —Å–µ–∫—É–Ω–¥
  const now = Date.now();
  emojiList = emojiList.filter(e => now - e.time < 1500);
  
  ctx.font = '20px sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  
  for (let emo of emojiList) {
    const t = (now - emo.time) / 1500;
    // t –∏–¥—ë—Ç –æ—Ç 0 –¥–æ 1, –º–æ–∂–Ω–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Å–¥–µ–ª–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —Å–º–µ—â–µ–Ω–∏—è/–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
    const alpha = 1 - t;
    
    ctx.globalAlpha = alpha;
    const px = emo.x * CELL_SIZE + CELL_SIZE / 2;
    const py = emo.y * CELL_SIZE - 20; // —á—É—Ç—å –≤—ã—à–µ –∫–ª–µ—Ç–∫–∏
    ctx.fillText(emo.symbol, px, py);
  }
  ctx.globalAlpha = 1;
}

// –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏–º UI –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
updateUI();

// –°–ª—É—á–∞–π–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
redOddsValue  = (1.2 + Math.random() * 1.0).toFixed(2);
blueOddsValue = (1.2 + Math.random() * 1.0).toFixed(2);
document.getElementById('redOdds').innerText  = redOddsValue;
document.getElementById('blueOdds').innerText = blueOddsValue;

// –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –≤—ã–∑–≤–∞—Ç—å initGame(), 
// –Ω–æ —Ç–æ–≥–¥–∞ –±–æ–π –Ω–∞—á–Ω—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –Ω–∞–∂–∞—Ç–∏—é "–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –∏ –Ω–∞—á–∞—Ç—å –±–æ–π".
// initGame();

</script>
</body>
</html>
